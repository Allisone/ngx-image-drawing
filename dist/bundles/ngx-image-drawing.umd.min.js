!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("fabric")):"function"==typeof define&&define.amd?define("ngx-image-drawing",["exports","@angular/common","@angular/core","fabric"],t):t((e=e||self)["ngx-image-drawing"]={},e.ng.common,e.ng.core,e.fabric)}(this,function(e,t,o,n){"use strict";function r(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s}function i(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function s(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,r,i=o.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(a){r={error:a}}finally{try{n&&!n.done&&(o=i["return"])&&o.call(i)}finally{if(r)throw r.error}}return s}var a=function(){function e(){this.saveBtnText="Save",this.cancelBtnText="Cancel",this.loadingText="Loadingâ€¦",this.errorText="Error loading %@",this.outputMimeType="image/jpeg",this.outputQuality=.8,this.onSave=new o.EventEmitter,this.onCancel=new o.EventEmitter,this.currentTool="brush",this.currentSize="medium",this.currentColor="black",this.canUndo=!1,this.canRedo=!1,this.isLoading=!0,this.hasError=!1,this.errorMessage="",this.stack=[]}return e.prototype.ngOnInit=function(){var e=this,t=new n.fabric.Canvas("canvas",{hoverCursor:"pointer",isDrawingMode:!0});if(this.src!==undefined){var o=!0,r=new Image;r.setAttribute("crossOrigin","anonymous"),r.src=this.src,r.onerror=function(){o?(r.src="http://cors-anywhere.herokuapp.com/"+e.src,o=!1):(e.isLoading=!1,e.hasError=!0,e.errorMessage=e.errorText.replace("%@",e.src))},r.onload=function(){e.isLoading=!1;var o=new n.fabric.Image(r);t.setBackgroundImage(o,function(e){null!==e&&(t.setWidth(e.width),t.setHeight(e.height))},{crossOrigin:"anonymous",originX:"left",originY:"top"})}}t.on("path:created",function(t){e.stack=[],e.setUndoRedo()}),this.canvas=t,this.selectTool(this.currentTool),this.selectColor(this.currentColor),this.selectDrawingSize(this.currentSize)},e.prototype.selectTool=function(e){this.currentTool=e},e.prototype.selectDrawingSize=function(e){this.currentSize=e,null!==this.canvas&&this.canvas!==undefined&&("small"===e?this.canvas.freeDrawingBrush.width=5:"medium"===e?this.canvas.freeDrawingBrush.width=10:"large"===e&&(this.canvas.freeDrawingBrush.width=20))},e.prototype.selectColor=function(e){this.currentColor=e,null!==this.canvas&&this.canvas!==undefined&&("black"===e?this.canvas.freeDrawingBrush.color="#000":"white"===e?this.canvas.freeDrawingBrush.color="#fff":"yellow"===e?this.canvas.freeDrawingBrush.color="#ffeb3b":"red"===e?this.canvas.freeDrawingBrush.color="#f44336":"blue"===e?this.canvas.freeDrawingBrush.color="#2196f3":"green"===e&&(this.canvas.freeDrawingBrush.color="#4caf50"))},e.prototype.undo=function(){if(this.canUndo){var e=this.canvas.getObjects().length-1,t=this.canvas.getObjects()[e];this.stack.push(t),this.canvas.remove(t),this.setUndoRedo()}},e.prototype.redo=function(){if(this.canRedo){var e=this.stack.splice(-1,1)[0];null!==e&&e!==undefined&&this.canvas.insertAt(e,this.canvas.getObjects().length-1),this.setUndoRedo()}},e.prototype.clearCanvas=function(){var e;null!==this.canvas&&this.canvas!==undefined&&((e=this.canvas).remove.apply(e,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e}(this.canvas.getObjects())),this.setUndoRedo())},e.prototype.saveImage=function(){var e=this;this.canvas.getElement().toBlob(function(t){e.onSave.emit(t)},this.outputMimeType,this.outputQuality)},e.prototype.cancel=function(){this.onCancel.emit()},e.prototype.setUndoRedo=function(){this.canUndo=this.canvas.getObjects().length>0,this.canRedo=this.stack.length>0},r([o.Input(),i("design:type",String)],e.prototype,"src",void 0),r([o.Input(),i("design:type",Object)],e.prototype,"saveBtnText",void 0),r([o.Input(),i("design:type",Object)],e.prototype,"cancelBtnText",void 0),r([o.Input(),i("design:type",Object)],e.prototype,"loadingText",void 0),r([o.Input(),i("design:type",Object)],e.prototype,"errorText",void 0),r([o.Input(),i("design:type",o.TemplateRef)],e.prototype,"loadingTemplate",void 0),r([o.Input(),i("design:type",o.TemplateRef)],e.prototype,"errorTemplate",void 0),r([o.Input(),i("design:type",String)],e.prototype,"outputMimeType",void 0),r([o.Input(),i("design:type",Number)],e.prototype,"outputQuality",void 0),r([o.Output(),i("design:type",o.EventEmitter)],e.prototype,"onSave",void 0),r([o.Output(),i("design:type",o.EventEmitter)],e.prototype,"onCancel",void 0),e=r([o.Component({selector:"image-drawing",template:'<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">\n\n<div class="loading" *ngIf="isLoading">\n    <ng-container *ngTemplateOutlet="loadingTemplate ? loadingTemplate : defaultLoading"></ng-container>\n</div>\n<div class="error" *ngIf="hasError">\n    <ng-container *ngTemplateOutlet="errorTemplate ? errorTemplate : defaultError"></ng-container>\n</div>\n\n<ng-template #defaultLoading><p>{{ loadingText }}</p></ng-template>\n<ng-template #defaultError><p>{{ errorMessage }}</p></ng-template>\n\n<canvas id="canvas"></canvas>\n<div class="toolbar" *ngIf="!isLoading">\n    <div class="tools">\n        <div class="row">\n            <i class="material-icons btn" [class.selected]="currentTool == \'brush\'" (click)="selectTool(\'brush\')" title="Pinceau">brush</i>\n            <span class="size small btn" [class.selected]="currentSize == \'small\'" (click)="selectDrawingSize(\'small\')"\n                title="Taille: petit"></span>\n            <span class="size medium btn" [class.selected]="currentSize == \'medium\'" (click)="selectDrawingSize(\'medium\')"\n                title="Taille: moyen"></span>\n            <span class="size large btn" [class.selected]="currentSize == \'large\'" (click)="selectDrawingSize(\'large\')"\n                title="Taille: grand"></span>\n            <i class="material-icons btn" [class.disabled]="!canUndo" (click)="undo()" title="Annuler">undo</i>\n            <i class="material-icons btn" [class.disabled]="!canRedo" (click)="redo()" title="Refaire">redo</i>\n            <i class="material-icons btn" (click)="clearCanvas()" title="Effacer tout">delete</i>\n        </div>\n        <div class="row">\n            <div class="color black" [class.selected]="currentColor == \'black\'" (click)="selectColor(\'black\')" title="Noir"></div>\n            <div class="color white" [class.selected]="currentColor == \'white\'" (click)="selectColor(\'white\')" title="Blanc"></div>\n            <div class="color yellow" [class.selected]="currentColor == \'yellow\'" (click)="selectColor(\'yellow\')" title="Jaune"></div>\n            <div class="color red" [class.selected]="currentColor == \'red\'" (click)="selectColor(\'red\')" title="Rouge"></div>\n            <div class="color green" [class.selected]="currentColor == \'green\'" (click)="selectColor(\'green\')" title="Vert"></div>\n            <div class="color blue" [class.selected]="currentColor == \'blue\'" (click)="selectColor(\'blue\')" title="Bleu"></div>\n        </div>\n    </div>\n    <div class="buttons">\n        <a href="#" class="button btn-primary" (click)="saveImage(); $event.preventDefault();">{{ saveBtnText }}</a>\n        <a href="#" class="button btn-light" (click)="cancel(); $event.preventDefault();">{{ cancelBtnText }}</a>\n    </div>\n</div>\n',styles:[':host{display:flex;flex-direction:column;align-items:center}:host .toolbar{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap}:host .tools{display:inline-flex;flex-direction:column;padding:20px;margin:10px;background:#fff;border-radius:6px;box-shadow:0 3px 10px rgba(0,0,0,.4)}:host .row{display:flex;width:300px;justify-content:space-around;align-items:center}:host .row:first-child{margin-bottom:10px}:host .btn{cursor:pointer}:host .btn.selected{color:#bdbdbd}:host .btn.disabled{cursor:initial;color:#bdbdbd}:host .size{background-color:#000}:host .size.selected{background-color:#bdbdbd}:host .size.small{height:12px;width:12px;border-radius:6px}:host .size.medium{height:16px;width:16px;border-radius:8px}:host .size.large{height:20px;width:20px;border-radius:10px}:host .color{width:28px;height:28px;border-radius:14px;cursor:pointer;display:flex;align-items:center;justify-content:center}:host .color.selected::after{content:"";width:10px;height:10px;background:#000;display:flex;border-radius:5px}:host .color.black{background-color:#000}:host .color.black.selected::after{background:#fff}:host .color.white{border:1px solid #a7a7a7}:host .color.yellow{background-color:#ffeb3b}:host .color.red{background-color:#f44336}:host .color.blue{background-color:#2196f3}:host .color.green{background-color:#4caf50}:host .buttons{margin:10px;display:flex;flex-direction:column}:host .button{cursor:pointer;outline:0;border:none;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;min-width:64px;line-height:36px;padding:3px 16px;border-radius:4px;overflow:visible;transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1);margin:10px}:host .button:hover{text-decoration:none!important}:host .button.btn-primary{background-color:#ef5f27;color:#fff}:host .button.btn-primary:hover{background-color:rgba(239,95,39,.8)}:host .button.btn-light{color:#ef5f27}:host .button.btn-light:hover{background-color:rgba(239,95,39,.1)}']}),i("design:paramtypes",[])],e)}(),c=function(){function e(){}return e=r([o.NgModule({declarations:[a],exports:[a],imports:[t.CommonModule]})],e)}();e.ImageDrawingComponent=a,e.ImageDrawingModule=c,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-image-drawing.umd.min.js.map