{"version":3,"file":"ngx-image-drawing.js","sources":["ng://ngx-image-drawing/src/image-drawing.component.ts","ng://ngx-image-drawing/src/image-drawing.module.ts","ng://ngx-image-drawing/ngx-image-drawing.ts"],"sourcesContent":["import { Component, EventEmitter, Input, OnInit, Output, TemplateRef } from '@angular/core';\nimport { fabric } from 'fabric';\n\n@Component({\n    selector: 'image-drawing',\n    styleUrls: ['./image-drawing.component.scss'],\n    templateUrl: './image-drawing.component.html'\n})\nexport class ImageDrawingComponent implements OnInit {\n\n    @Input() public src?: string;\n    @Input() public saveBtnText = 'Save';\n    @Input() public cancelBtnText = 'Cancel';\n    @Input() public loadingText = 'Loadingâ¦';\n    @Input() public errorText = 'Error loading %@';\n    @Input() public loadingTemplate?: TemplateRef<any>;\n    @Input() public errorTemplate?: TemplateRef<any>;\n\n    @Output() public onSave: EventEmitter<Blob> = new EventEmitter<Blob>();\n    @Output() public onCancel: EventEmitter<void> = new EventEmitter<void>();\n\n    public currentTool: string = 'brush';\n    public currentSize: string = 'medium';\n    public currentColor: string = 'black';\n\n    public canUndo: boolean = false;\n    public canRedo: boolean = false;\n\n    public isLoading = true;\n    public hasError = false;\n    public errorMessage = '';\n\n    private canvas?: any;\n    private stack: any[] = [];\n\n    constructor() {\n    }\n\n    public ngOnInit(): void {\n        const canvas = new fabric.Canvas('canvas', {\n            hoverCursor: 'pointer',\n            isDrawingMode: true,\n        });\n        if (this.src !== undefined) {\n            const imgEl = new Image();\n            imgEl.setAttribute('crossOrigin', 'anonymous');\n            imgEl.src = 'http://cors-anywhere.herokuapp.com/' + this.src;\n            imgEl.onerror = (event) => {\n                console.error(event);\n                this.isLoading = false;\n                this.hasError = true;\n                this.errorMessage = this.errorText.replace('%@', this.src as string);\n            };\n            imgEl.onload = () => {\n                this.isLoading = false;\n                const fabricImg = new fabric.Image(imgEl);\n                canvas.setBackgroundImage(fabricImg, ((img: HTMLImageElement) => {\n                    if (img !== null) {\n                        canvas.setWidth(img.width);\n                        canvas.setHeight(img.height);\n                    }\n                }), {\n                        crossOrigin: 'anonymous',\n                        originX: 'left',\n                        originY: 'top'\n                    });\n            };\n        }\n\n        canvas.on('path:created', (e) => {\n            this.stack = [];\n            this.setUndoRedo();\n        });\n\n        this.canvas = canvas;\n        this.selectTool(this.currentTool);\n        this.selectColor(this.currentColor);\n        this.selectDrawingSize(this.currentSize);\n    }\n\n    // Tools\n\n    public selectTool(tool: string) {\n        this.currentTool = tool;\n    }\n\n    public selectDrawingSize(size: string) {\n        this.currentSize = size;\n        if (this.canvas !== null && this.canvas !== undefined) {\n            if (size === 'small') {\n                this.canvas.freeDrawingBrush.width = 5;\n            } else if (size === 'medium') {\n                this.canvas.freeDrawingBrush.width = 10;\n            } else if (size === 'large') {\n                this.canvas.freeDrawingBrush.width = 20;\n            }\n        }\n    }\n\n    public selectColor(color: string) {\n        this.currentColor = color;\n        if (this.canvas !== null && this.canvas !== undefined) {\n            if (color === 'black') {\n                this.canvas.freeDrawingBrush.color = '#000';\n            } else if (color === 'white') {\n                this.canvas.freeDrawingBrush.color = '#fff';\n            } else if (color === 'yellow') {\n                this.canvas.freeDrawingBrush.color = '#ffeb3b';\n            } else if (color === 'red') {\n                this.canvas.freeDrawingBrush.color = '#f44336';\n            } else if (color === 'blue') {\n                this.canvas.freeDrawingBrush.color = '#2196f3';\n            } else if (color === 'green') {\n                this.canvas.freeDrawingBrush.color = '#4caf50';\n            }\n        }\n    }\n\n    // Actions\n\n    public undo() {\n        if (this.canUndo) {\n            const lastId = this.canvas.getObjects().length - 1;\n            const lastObj = this.canvas.getObjects()[lastId];\n            this.stack.push(lastObj);\n            this.canvas.remove(lastObj);\n            this.setUndoRedo();\n        }\n    }\n\n    public redo() {\n        if (this.canRedo) {\n            const firstInStack = this.stack.splice(-1, 1)[0];\n            if (firstInStack !== null && firstInStack !== undefined) {\n                this.canvas.insertAt(firstInStack, this.canvas.getObjects().length - 1);\n            }\n            this.setUndoRedo();\n        }\n    }\n\n    public clearCanvas() {\n        if (this.canvas !== null && this.canvas !== undefined) {\n            this.canvas.remove(...this.canvas.getObjects());\n            this.setUndoRedo();\n        }\n    }\n\n    public saveImage() {\n        this.canvas.getElement().toBlob((data: Blob) => {\n            this.onSave.emit(data);\n        });\n    }\n\n    public cancel() {\n        this.onCancel.emit();\n    }\n\n    private setUndoRedo() {\n        this.canUndo = this.canvas.getObjects().length > 0;\n        this.canRedo = this.stack.length > 0;\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { ImageDrawingComponent } from './image-drawing.component';\n\n@NgModule({\n    declarations: [\n        ImageDrawingComponent\n    ],\n    exports: [\n        ImageDrawingComponent\n    ],\n    imports: [\n        CommonModule\n    ]\n})\nexport class ImageDrawingModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["tslib_1.__decorate"],"mappings":"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"}